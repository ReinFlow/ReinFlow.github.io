<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReinFlow Experiments</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            }
        });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0 auto;
            max-width: 900px;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1 {
            font-size: 2.5em;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        h2 {
            font-size: 1.8em;
            color: #34495e;
            margin-top: 40px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        h3 {
            font-size: 1.4em;
            color: #34495e;
            margin-top: 30px;
        }
        p {
            font-size: 1.1em;
            margin: 10px 0;
        }
        .figure-container {
            margin: 10px 0;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .subfigure-row {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 1px;
        }
        .subfigure {
            flex: 0 0 24%;
            text-align: center;
            margin-bottom: 1px;
        }
        .subfigure-3 {
            flex: 0 0 32%;
            text-align: center;
            margin-bottom: 1px;
        }
        .subfigure-2 {
            flex: 0 0 49%;
            text-align: center;
            margin-bottom: 1px;
        }
        img {
            width: 600px;
            height: 400px;
            object-fit: contain;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            display: block;
            margin: 0 auto;
        }
        .subfigure img {
            width: 100%;
            height: 200px;
            object-fit: contain;
        }
        .subfigure-3 img {
            width: 100%;
            height: 200px;
            object-fit: contain;
        }
        .subfigure-2 img {
            width: 100%;
            height: 200px;
            object-fit: contain;
        }
        .legend img {
            width: 600px;
            height: 100px;
            object-fit: contain;
        }
        img[alt="Legend44"] {
            height: 40%;
            width: 64%;
        }
        img[alt="Legend4"] {
            height: 50%;
            width: 80%;
        }
        img[alt="Legend3"] {
            height: 20%;
            width: 60%;
        }
        .caption {
            font-size: 0.95em;
            color: #555;
            text-align: left;
            margin-top: 1px;
        }
        .subfigure-caption {
            font-size: 0.9em;
            color: #555;
            margin-top: 1px;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .subfigure-row {
            margin-bottom: 2px !important;
        }
        .figure-container.legend {
            margin-top: 0px !important;
            margin-bottom: 0px !important;
            background: transparent !important;
            box-shadow: none !important;
            padding: 0 !important;
        }
        .figure-container.legend img[alt="Legend3"],
        .figure-container.legend img[alt="Legend4"] {
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            background: transparent !important;
            display: block;
            width: 100%;
            height: 40px;
            object-fit: contain;
        }
        .figure-container.legend img[alt="Legend44"] {
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            background: transparent !important;
            display: block;
            width: 1000%;
            height: 25px;
            object-fit: contain;
        }
        img[alt="schematic"] {
            width: 90%;    /* or a fixed width like 600px */
            height: auto;   /* auto height keeps aspect ratio */
            display: block; /* remove inline spacing */
            margin: 0 auto; /* center horizontally */
            max-width: 800px; /* optional max width */
        }
        .subfigure img,
        .subfigure-2 img{
            width: 100%;
            height: 140px;
            object-fit: contain;
        }
         /* Indent the first line of each paragraph by 30px */
        .indented-paragraph {
            text-indent: 30px;
        }
    </style>
</head>
<body>
    <h1>ReinFlow: Fine-tuning Flow Matching Policy with Online Reinforcement Learning</h1>
    <div class="figure-container">
        <img src="figs/jpgs/ReinFlow.jpg" alt="schematic">
        <div class="caption">
            <!-- <p>Fine-tuning Flow Matching Policy with ReinFlow. 
            Through interactions with the environment, the robot collects visual and proprioceptive signals, 
            from which a pre-trained policy extracts features and outputs the next action's velocity field $v_\theta$. 
            A noise injection network $\sigma_{\theta^\prime}$ shares the extracted features with $v_\theta$ and outputs a Gaussian noise that smoothens the flow's deterministic ODE path, converting flows to a discrete-time Markov process with Gaussian transition probabilities. 
            The noise injection yields a simple and exact likelihood expression at any denoising steps, which is friendly for policy gradient optimization. 
            The noise injection net $\sigma_{\theta^\prime}$, surrounded by the dot lines, is co-trained with $v_\theta$ but will be discarded after fine-tuning.</p> -->
            <ul>
            <p>Fine-tuning flow matching policy with ReinFlow involves these steps:</p>
            <!-- <ul> -->
            <li><b>1. Rollout</b>: The robot interacts with the environment online and gathers visual and proprioceptive observation. </li>
            <li><b>2. Extract Features</b>: A pre-trained policy backbone extracts visuomotor features and feeds them to the velocity field $v_\theta$, which guides the next action's changes.</li>
            <li><b>3. Add Noise</b>: The network $\sigma_{\theta^\prime}$ shares extracted features with the velocity net and outputs Gaussian noise to smooth the ODE path for likelihood evaluation. </li>
            <li><b>4. Co-train and Discard</b>: The network $\sigma_{\theta^\prime}$ co-trains with $v_\theta$ only during fine-tuning and is discarded afterward.</li>
            <!-- </ul> ¬† ¬† ¬† ¬† ¬†-->
            </ul>
        </div>
    </div>

   <section id="experiments">
  <h2>Experiments</h2>
  <ul style="list-style: none; padding-left: 0; font-family: Arial, sans-serif; max-width: 800px;">
    <li style="margin-bottom: 12px;">
      üéØ <strong>Goal:</strong> Increase success rate for pre-trained flow policies at minimal denoising steps
    </li>
    <li style="margin-bottom: 12px;">
      ‚è±Ô∏è <strong>Focus:</strong> Wall time efficiency for simulated tasks
    </li>
    <li>
      üìä <strong>Baselines:</strong> DPPO, FQL, Gaussian, etc. (see Appendix for more)
    </li>
  </ul>
</section>

    <!-- <section id="env-setup">
        <h3>Environment and Data</h3>
        <p> <b>State input, dense reward locomotion</b> in OpenAI Gym using D4RL data</p>
        <p> <b>State input, sparse reward</b>in Franka Kitchen using human-teleoperated data from D4RL. </p>
        <p> <b>Visual input, sparse reward Manipulation</b> in Robomimic using human-teleported data processed like DPPO's paper.</p>
    </section>  -->
    <section id="env-setup">
    <h3>Environment and Data</h3>
    <table style="width: 100%; border-collapse: collapse; text-align: left;">
        <thead>
        <tr>
            <th style="border-bottom: 2px solid #333; padding: 8px;">Input Type</th>
            <th style="border-bottom: 2px solid #333; padding: 8px;">Reward Type</th>
            <th style="border-bottom: 2px solid #333; padding: 8px;">Environment</th>
            <th style="border-bottom: 2px solid #333; padding: 8px;">Data Source</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td style="padding: 8px;">State <strong></strong></td>
            <td style="padding: 8px;">Dense</td>
            <td style="padding: 8px;">OpenAI Gym</td>
            <td style="padding: 8px;">D4RL data</td>
        </tr>
        <tr>
            <td style="padding: 8px;">State<strong></strong></td>
            <td style="padding: 8px;"><strong>Sparse</strong></td></td>
            <td style="padding: 8px;">Franka Kitchen</td>
            <td style="padding: 8px;">Human-teleoperated data from D4RL</td>
        </tr>
        <tr>
            <td style="padding: 8px;"><strong>Visual</strong></td>
            <td style="padding: 8px;"><strong>Sparse</strong></td></td>
            <td style="padding: 8px;">Robomimic</td>
            <td style="padding: 8px;">Human-teleoperated data processed like DPPO's paper</td>
        </tr>
        </tbody>
    </table>
    </section>
    <section id="performance-evaluation">
        <h3>Performance Evaluation</h3>
        <p>ReinFlow consistently improves performance across all tasks, excelling in Gym and Franka Kitchen benchmarks.</p>
        <div class="figure-container">
            <div class="subfigure-row">
                <div class="subfigure">
                    <img src="figs/jpgs/gym-state_hopper-d4rl_AverageEpisodeReward_wallclock-page1.jpg" alt="Hopper-v2 Wall Time">
                    <div class="subfigure-caption">(A) Hopper-v2</div>
                </div>
                <div class="subfigure">
                    <img src="figs/jpgs/gym-state_walker-d4rl_AverageEpisodeReward_wallclock-page1.jpg"  alt="Walker-v2 Wall Time">
                    <div class="subfigure-caption">(B) Walker-v2</div>
                </div>
                <div class="subfigure">
                    <img src="figs/jpgs/gym-state_ant-d4rl_AverageEpisodeReward_wallclock-page1.jpg" alt="Ant-v2 Wall Time">
                    <div class="subfigure-caption">(C) Ant-v2</div>
                </div>
                <div class="subfigure">
                    <img src="figs/jpgs/gym-state_humanoid-d4rl_AverageEpisodeReward_wallclock-page1.jpg" alt="Humanoid-v3 Wall Time">
                    <div class="subfigure-caption">(D) Humanoid-v3</div>
                </div>
            </div>
            <div class="figure-container legend">
                <img src="figs/jpgs/gym-state_hopper-d4rl_AverageEpisodeReward_legend_crop-page1.jpg" alt="Legend44">
            </div>
            <div class="caption">
                Wall time efficiency results of state-based locomotion tasks in OpenAI Gym. Dashed lines indicate the behavior cloning level.
            </div>
        </div>
        <div class="figure-container">
            <div class="subfigure-row">
                <div class="subfigure">
                    <img src="figs/jpgs/kitchen_kitchen-complete-v0_TaskCompletionRate_wallclock-page1.jpg" alt="Kitchen-complete Wall Time">
                    <div class="subfigure-caption">(A) Kitchen-complete</div>
                </div>
                <div class="subfigure">
                    <img src="figs/jpgs/kitchen_kitchen-complete-v0_TaskCompletionRate-page1.jpg" alt="Kitchen-complete Sample">
                    <div class="subfigure-caption">(B) Kitchen-complete</div>
                </div>
                <div class="subfigure">
                    <img src="figs/jpgs/kitchen_kitchen-mixed-v0_TaskCompletionRate-page1.jpg" alt="Kitchen-mixed Sample">
                    <div class="subfigure-caption">(C) Kitchen-mixed</div>
                </div>
                <div class="subfigure">
                    <img src="figs/jpgs/kitchen_kitchen-partial-v0_TaskCompletionRate-page1.jpg" alt="Kitchen-partial Sample">
                    <div class="subfigure-caption">(D) Kitchen-partial</div>
                </div>
            </div>
            <div class="figure-container legend">
                <img src="figs/jpgs/kitchen_kitchen-complete-v0_TaskCompletionRate_legend_crop-page1.jpg" alt="Legend3">
            </div>
            <div class="caption">
                Task completion rates of state-input manipulation tasks in Franka Kitchen. (A) and (B) show the completion rates against the wall time and sample cost. We only show the sample cost plots for agents trained on mixed and partial datasets for brevity.
            </div>
        </div>
        <p>In Robomimic tasks, ReinFlow boosts success rates by 40.09% with fewer steps and time than DPPO, using minimal denoising steps.</p>
        <div class="figure-container">
            <div class="subfigure-row">
                <div class="subfigure-3">
                    <img src="figs/jpgs/robomimic-img_can-img_SuccessRate-page1.jpg" alt="Can Success Rate">
                    <div class="subfigure-caption">(A) Can</div>
                </div>
                <div class="subfigure-3">
                    <img src="figs/jpgs/robomimic-img_square-img_SuccessRate-page1.jpg" alt="Square Success Rate">
                    <div class="subfigure-caption">(B) Square</div>
                </div>
                <div class="subfigure-3">
                    <img src="figs/jpgs/robomimic-img_transport-img_SuccessRate-page1.jpg" alt="Transport Success Rate">
                    <div class="subfigure-caption">(C) Transport</div>
                </div>
            </div>
            <div class="figure-container legend">
                <img src="figs/jpgs/robomimic-img_can-img_SuccessRate_legend_crop-page1.jpg" alt="Legend4">
            </div>
            <div class="caption">
                Success rates in visual manipulation tasks in Robomimic.
            </div>
        </div>
    </section>

    <section id="design-choice">
        <h3>The Design Choice and Key Factors Affecting ReinFlow</h3>
        <p>We examine how pre-trained models, denoising steps, noise levels, and regularization impact ReinFlow.</p>
        <h4>RL Provides Another Scaling Dimension</h4>
        <p class="indented-paragraph" style="font-family: Arial, sans-serif; max-width: 800px; line-height: 1.4;">
            <span style="font-size: 1.2em; margin-right: 6px;">‚ûñ </span>
            Scaling data or inference steps: quickly plateaus.<br>
        </p>
        <p class="indented-paragraph">
            <span style="font-size: 1.2em; margin-right: 6px;">üìà</span>
            Fine-tuning with RL (ReinFlow): consistently enhances performance. 
        </p>
        <div class="figure-container">
            <div class="subfigure-row">
                <div class="subfigure-3">
                    <img src="figs/jpgs/avg_episode_reward_3d_surface-page1.jpg" alt="ReFlow Policy in Hopper-v2">
                    <div class="subfigure-caption">(A) ReFlow Policy in Hopper-v2</div>
                </div>
                <div class="subfigure-3">
                    <img src="figs/jpgs/datascale_shortcut_square_success_rate_2d-page1.jpg" alt="Shortcut Policy in Square">
                    <div class="subfigure-caption">(B) Shortcut Policy in Square</div>
                </div>
                <div class="subfigure-3">
                    <img src="figs/jpgs/robomimic-img_square-img-logitbeta_SuccessRate-page1.jpg" alt="ReFlow Policy in Square">
                    <div class="subfigure-caption">(C) ReFlow Policy in Square</div>
                </div>
            </div>
            <div class="caption">
                RL provides another way of scaling apart from increasing pre-training data and inference consumption, which has a plateauing effect. The improvement is invariant of flow policy‚Äôs time distribution and is achievable at four steps in Hopper (A) and one step in Square (B, C).
            </div>
        </div>
        <h4>Flow Matching's Time Distribution</h4>
        <p>ReinFlow's performance is robust to changes in time sampling. </p>
        <p class="indented-paragraph">‚úÖ Uniform </p>
        <p class="indented-paragraph">‚úÖ Logit-normal </p>
        <p class="indented-paragraph">‚úÖ Beta (slightly better for single-step fine-tuning.)</p>
        <h4>Noise Network Inputs</h4>
            <p class="indented-paragraph" style="text-indent: 30px; font-family: Arial, sans-serif; line-height: 1.6; margin: 0 0 12px 0;">
            <span style="font-size: 1.3em; margin-right: 8px;" aria-hidden="true">üòä</span>
            Conditioning noise on state alone works well.
            </p>
            <p class="indented-paragraph" style="text-indent: 30px; font-family: Arial, sans-serif; line-height: 1.6; margin: 0;">
            <span style="font-size: 1.3em; margin-right: 8px;" aria-hidden="true">üòÑ</span>
            Conditioning noise on both state and time generates more diverse actions and improves success rates.
            </p>
        <div class="figure-container">
            <div class="subfigure-row">
                <div class="subfigure-2">
                    <img src="figs/jpgs/noise_parameterization_ant-page1.jpg" alt="Noise Input's Effect in Ant-v0">
                    <div class="subfigure-caption">(A) Noise Input's Effect in Ant-v0</div>
                </div>
                <div class="subfigure-2">
                    <img src="figs/jpgs/kitchen_kitchen-partial-v0-sigma_s_t_SuccessRate-page1.jpg" alt="Noise Condition's Effect in Kitchen-partial">
                    <div class="subfigure-caption">(B) Noise Condition's Effect in Kitchen-partial</div>
                </div>
            </div>
            <div class="caption">
                Conditioning on state and time yields a higher success rate than only conditioning on states.
            </div>
        </div>
        <h4>Noise Level and Exploration</h4>
            <p style="text-indent: 30px; font-family: Arial, sans-serif; line-height: 1.6; margin: 0 0 12px 0;">
            <span style="font-size: 1.3em; margin-right: 8px;">‚öñÔ∏è</span>
            Noise magnitude affects exploration: too little traps the policy, too much hurts execution.
            </p>
            <p style="text-indent: 30px; font-family: Arial, sans-serif; line-height: 1.6; margin: 0 0 12px 0;">
            <span style="font-size: 1.3em; margin-right: 8px;">üöÄ</span>
            Optimal noise levels enable significant gains, especially in complex tasks.
            </p>
            <p style="text-indent: 30px; font-family: Arial, sans-serif; line-height: 1.6; margin: 0;">
            <span style="font-size: 1.3em; margin-right: 8px;">üîí</span>
            Policies become less sensitive to noise once in the correct region.
            </p>
        <h4>Regularization and Exploration</h4>
            <p style="text-indent: 30px; font-family: Arial, sans-serif; line-height: 1.6; margin: 0 0 12px 0;">
            <span style="font-size: 1.3em; margin-right: 8px;">üèÖ</span>
            Entropy regularization promotes exploration, while behavior cloning regularization can trap the policy and is unnecessary.
            </p>
            <p style="text-indent: 30px; font-family: Arial, sans-serif; line-height: 1.6; margin: 0;">
            <span style="font-size: 1.3em; margin-right: 8px;">üèÖ</span>
            Entropy regularization outperforms Wasserstein-2 constraints used in offline RL methods like FQL.
            </p>
        <div class="figure-container">
            <div class="subfigure-row">
                <div class="subfigure-2">
                    <img src="figs/jpgs/constant_noise_level-page1.jpg" alt="Noise Level Affects Exploration in Ant-v0">
                    <div class="subfigure-caption">(A) Noise Level Affects Exploration in Ant-v0</div>
                </div>
                <div class="subfigure-2">
                    <img src="figs/jpgs/gym-state_humanoid-regularize-compare_AverageEpisodeReward-page1.jpg" alt="Regularization Affects ReinFlow in Humanoid-v3">
                    <div class="subfigure-caption">(B) Regularization Affects ReinFlow in Humanoid-v3</div>
                </div>
            </div>
            <div class="caption">
                Noise level and regularization's effect. (A) demonstrates constant noise with different standard deviation affects ReinFlow's exploration. (B) shows how entropy regularization with coefficient $\alpha$ and $W_2$ regularization with different coefficients $\beta$ influences ReinFlow.
            </div>
        </div>
    </section>
</body>
</html>